---
title: "M1 Macã«å¤ã„Pythonã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ˆPython3.6.xï¼‰"
emoji: "ğŸ˜¸"
type: "tech"
topics:
  - "homebrew"
  - "macos"
  - "pyenv"
  - "m1"
  - "rosetta2"
published: true
published_at: "2022-08-17 18:13"
---

# æ¦‚è¦
ç™ºå£²ç›´å¾Œã«æ¯”ã¹ã‚‹ã¨ã‚„ã‚„è½ã¡ç€ã„ã¦ããŸM1 Macé¢å€’ã™ãå•é¡Œã§ã™ãŒã€2022å¹´ç¾åœ¨ã§ã‚‚å®šæœŸçš„ã«å£ã«ã¶ã¤ã‹ã‚‹ä»Šæ—¥ã“ã®é ƒã€ã“ã®åº¦ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«Python3.6.9ã‚’å…¥ã‚Œãªãã¦ã¯ã„ã‘ãªã„å¿…è¦ãŒå‡ºã¦ããŸã®ã§ã™ãŒã€æœ¬æ—¥ã¯ãã®æ™‚ã®æƒ…å ±ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

## å‚è€ƒURL
- [stack overflow ã€Install python 3.6.* on Mac M1ã€‘](https://stackoverflow.com/questions/71862398/install-python-3-6-on-mac-m1)
- [Mac(M1 CPU)ã§ã€äº’æ›æ€§ã®ã‚ã‚‹pyenv+pipenvã®ç’°å¢ƒã‚’ä½œã‚‹](https://qiita.com/niccari/items/50b930dd5de65d0c71af)
- [M1 Macã¸ã®Homebrewã®å°å…¥](https://zenn.dev/_lambda314/articles/63b851221a7016)

## ç’°å¢ƒ
- MacBook Pro (13-inch, M1, 2020)
- macOS Monterey ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 12.0.1

# å§‹ã‚ã«ç¢ºèª
## CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¾åœ¨ã®M1 Macã®CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒ`arm64`ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™

```shell
uname -m
```

## Homebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ï¼ˆæ—¢ã«HomebrewãŒå°å…¥ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼‰ 

ï¼ˆãªã‘ã‚Œã°ï¼‰`xcode-select`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è¡Œã„ã¾ã™

```shell
xcode-select --install
```

æ¬¡ã«[å…¬å¼](https://brew.sh/index_ja)ã«ã‚ã‚‹ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§M1 Macç”¨ã®Homebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

æœ€å¾Œã«ãƒ‘ã‚¹ã‚’é€šã—ã¾ã™ã€‚ã“ã“ã§ã¯`.zshrc`ã«è¿½è¨˜ã—ã¦ã„ã¾ã™ã€‚

``` shell:~/.zshrc
eval $(/opt/homebrew/bin/brew shellenv)
```

## pyenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ï¼ˆæ—¢ã«pyenvãŒå°å…¥ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼‰

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§`pyenv`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```shell
brew install pyenv
```

æ¬¡ã«ãƒ‘ã‚¹ã‚’é€šã—ã¾ã™ã€‚ã“ã“ã§ã¯`.zshrc`ã«è¿½è¨˜ã—ã¦ã„ã¾ã™ã€‚

``` shell:~/.zshrc
export PYENV_ROOT="$HOME/.pyenv/shims"
export PATH="$PYENV_ROOT:$PATH"
export PIPENV_PYTHON="$PYENV_ROOT/python"
eval "$(pyenv init --path)"
```

# Rosetta2é–¢é€£ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
## Rosetta2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
M1 Macã§ã¯ã€ã‚¤ãƒ³ãƒ†ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å‘ã‘ã«ä½œã‚‰ã‚ŒãŸã‚¢ãƒ—ãƒªã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ŒRosetta 2ã€ã‚’çµŒç”±ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```shell
softwareupdate --install-rosetta --agree-to-license
```

æ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‹ã©ã†ã‹ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã¿ã¾ã™

```shell
# ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆ
arch -x86_64 zsh

# åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ç¢ºèª
uname -m
```

ç„¡äº‹ã€`x86_64`ãŒå‡ºåŠ›ã•ã‚Œã‚Œã°OKã§ã™ã€‚`exit`ã‚³ãƒãƒ³ãƒ‰ã§ã“ã®ç’°å¢ƒã‚’çµ‚äº†ã—ã¦å…ƒã«æˆ»ã‚Œã¾ã™ã€‚ã‚‚ã—ãã¯`arch -arm64e zsh`ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã“ã¨ã§ã•ã‚‰ã«`arm64`ç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä»Šå¾Œã€ç’°å¢ƒã®åˆ‡ã‚Šæ›¿ãˆã‚’ç°¡å˜ã«è¡Œãˆã‚‹ã‚ˆã†`.zshrc`ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¨­å®šã—ã¦ãŠãã¨æ¥½ã§ã™ã€‚

``` shell:~/.zshrc
alias x86='arch -x86_64 zsh'
alias arm='arch -arm64e zsh'
```

![](https://storage.googleapis.com/zenn-user-upload/e805b073674e-20220817.png =250x)

## Rosetta2ç’°å¢ƒã«ãŠã‘ã‚‹Homebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```shell
arch -arch x86_64 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

ãƒ‘ã‚¹ã‚‚é€šã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…ˆã»ã©`.zshrc`ã§`arm64`ç”¨ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã—ãŸãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«å ´åˆã‚ã‘ã™ã‚‹ã“ã¨ã§ã€ç’°å¢ƒã«ã‚ˆã‚Šç•°ãªã‚‹brewã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†æ›¸ãæ›ãˆã¾ã™ã€‚

``` shell:~/.zshrc
if [ "$(uname -m)" = "arm64" ]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
  export PATH="/opt/homebrew/bin:$PATH"
else
  eval "$(/usr/local/bin/brew shellenv)"
fi
```

![](https://storage.googleapis.com/zenn-user-upload/6a61ab35222c-20220817.png =250x)

## Rosetta2ç’°å¢ƒã«ãŠã‘ã‚‹pyenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ç¾åœ¨ã®ç’°å¢ƒãŒ`x86_64`ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™ã€‚

```shell
brew install pyenv
```

ãƒ‘ã‚¹ã‚‚é€šã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…ˆã»ã©`.zshrc`ã§`arm64`ç”¨ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã—ãŸãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«å ´åˆã‚ã‘ã™ã‚‹ã“ã¨ã§ã€ç’°å¢ƒã«ã‚ˆã‚Šç•°ãªã‚‹pyenvã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†æ›¸ãæ›ãˆã¾ã™ã€‚

``` shell:~/.zshrc
if [ "$(uname -m)" = "arm64" ]; then
  export PYENV_ROOT="$HOME/.pyenv/shims"
  export PATH="$HOME/:$PATH"
else
  export PYENV_ROOT="$HOME/.pyenv_x86"
  export PATH="$HOME/.pyenv_x86/bin:$PATH"
fi
export PIPENV_PYTHON="$PYENV_ROOT/python"
eval "$(pyenv init --path)"
```

ã“ã®ã‚ˆã†ã«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯ã«pyenvã‚’åˆ†ã‘ã¦ç®¡ç†ã™ã‚‹ã“ã¨ã§ã€`~/.pyenv`ã€åŠã³`~/.pyenv_x86`ã¨ã„ã†äºŒã¤ã®pyenvç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚ä¸‹å›³ã¯å¾Œã€…ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’å…¨ã¦çµ‚äº†ã•ã›ãŸæ™‚ç‚¹ã§ã®ã‚‚ã®ã§ã™ãŒã€pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ¥ã€…ã«ç®¡ç†ã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚ï¼ˆå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`x86_64`ã§æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`arm64`ã§ç®¡ç†ã—ã¦ã„ã‚‹ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/d474b03ac1a9-20220817.png =400x)

## ï¼ˆè£œè¶³ï¼‰ç’°å¢ƒåˆ¥ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¡¨ç¤ºã‚’åˆ‡ã‚Šå¤‰ãˆã‚‹
ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯çµ¶å¯¾ã«å¿…è¦ã¨ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç’°å¢ƒæ¯ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã©ã‚’è¡¨ç¤ºåˆ†ã‘ã—ã¦ãŠãã“ã¨ã§ç„¡ç”¨ãªæ··ä¹±ã‚’å›é¿ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚è‡ªåˆ†ã®Macã¯`zplug`ã‚’å°å…¥ã—ã€ãã“ã‹ã‚‰å¿…è¦ãªãƒ†ãƒ¼ãƒã¨ã—ã¦`zplug "themes/tjkirch",   from:oh-my-zsh`ã‚’å°å…¥ã—ã¦ã„ã¦ã—ã£ãã‚Šãã¦ã„ã‚‹ã®ã§ã€ãã®ã¾ã¾ã«ã—ã¦ã„ã¾ã™ãŒã€ã‚‚ã—å ´åˆã‚ã‘ã—ãŸã„å ´åˆã€ä»¥ä¸‹ã¯ç°¡å˜ãªä¾‹ã§ã™ãŒã€ç’°å¢ƒå¤‰æ•°`PROMPT`ã‚’ä»¥ä¸‹ã®å®šç¾©ã—ã¦ãŠã„ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

``` shell:~/.zshrc
PROMPT="%F{green}%n%f %F{cyan}($(uname -m))%f:%F{blue}%~%f"$'\n'"%# "
```

# x86_64ç’°å¢ƒã«Python3.6.9ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®åŸºæœ¬æ“ä½œ
æœ¬é¡Œã®å‰ã«ã€ç­†è€…ã®`x86_64`ç’°å¢ƒã®brewã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ¼ãƒŸãƒ¥ãƒ©ã®ä¸€è¦§ã ã‘æ²è¼‰ã—ã¦ãŠãã¾ã™ã€‚ï¼ˆå¿…è¦ãªã‚‚ã®ä¸å¿…è¦ãªã‚‚ã®æ··åœ¨ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä¸€å¿œç’°å¢ƒã®ç¾çŠ¶ã¨ã—ã¦æ²è¼‰ï¼‰

``` shell
$ brew list
==> Formulae
autoconf	gettext		libffi		m4		pkg-config	xz
ca-certificates	gmp		libmpc		mpfr		pyenv		zstd
gcc		isl		lz4		openssl@1.1	readline
```

åŸºæœ¬çš„ãªæ“ä½œã¯`arm64`ç’°å¢ƒã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚`pyenv install {version}`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãŸã è‚å¿ƒã®3.6.9ã¯ã“ã®æ–¹æ³•ã ã¨ãƒ“ãƒ«ãƒ‰ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```shell
...
BUILD FAILED (OS X 12.0.1 ...

...

  By default, distutils will build C++ extension modules with "clang++".
  If this is not intended, then set CXX on the configure command line.

checking for the platform triplet based on compiler characteristics... darwin
configure: error: internal configure error for the platform triplet, please file a bug report
make: *** No targets specified and no makefile found.  Stop.
```

ãªã®ã§ä»¥ä¸‹ã®æµã‚Œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã—ã¦ã„ãã¾ã™

``` shell
# å„ãƒ•ã‚©ãƒ¼ãƒŸãƒ¥ãƒ©ã®ãƒ‘ã‚¹ã‚’ç’°å¢ƒå¤‰æ•°ã«ä»£å…¥
export CPPFLAGS="-I$(brew --prefix libffi)/include -I$(brew --prefix openssl)/include -I$(brew --prefix readline)/lib"

export CFLAGS="-I$(brew --prefix openssl)/include -I$(brew --prefix bzip2)/include -I$(brew --prefix readline)/include -I$(xcrun --show-sdk-path)/usr/include -Wno-implicit-function-declaration"

export LDFLAGS="-L$(brew --prefix openssl)/lib -L$(brew --prefix readline)/lib -L$(brew --prefix zlib)/lib -L$(brew --prefix bzip2)/lib -L$(brew --prefix gettext)/lib -L$(brew --prefix libffi)/lib"

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pyenv install --patch 3.6.9 <<(curl -sSL https://raw.githubusercontent.com/pyenv/pyenv/master/plugins/python-build/share/python-build/patches/3.6.15/Python-3.6.15/0008-bpo-45405-Prevent-internal-configure-error-when-runn.patch\?full_index\=1)

# å¾Œã€…é¢å€’ã«ãªã‚‰ãªã„ã‚ˆã†ç’°å¢ƒå¤‰æ•°ã‚’å‰Šé™¤
unset CPPFLAGS CFLAGS LDFLAGS
```

ã“ã‚Œã§ç„¡äº‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸ